"use strict";(self.webpackChunkhpc_wiki=self.webpackChunkhpc_wiki||[]).push([[163],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>d});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=o.createContext({}),u=function(e){var t=o.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=u(e.components);return o.createElement(l.Provider,{value:t},e.children)},m="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},h=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),m=u(n),h=a,d=m["".concat(l,".").concat(h)]||m[h]||c[h]||r;return n?o.createElement(d,i(i({ref:t},p),{},{components:n})):o.createElement(d,i({ref:t},p))}));function d(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=h;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[m]="string"==typeof e?e:a,i[1]=s;for(var u=2;u<r;u++)i[u]=n[u];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}h.displayName="MDXCreateElement"},2430:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>r,metadata:()=>s,toc:()=>u});var o=n(7462),a=(n(7294),n(3905));const r={sidebar_position:7,sidebar_label:"Job Scheduling",hide_table_of_contents:!0,hide_title:!0,pagination_next:null,pagination_prev:null,title:"Job Scheduling"},i=void 0,s={unversionedId:"faq/jobs/jobs",id:"faq/jobs/jobs",title:"Job Scheduling",description:"Job Scheduling",source:"@site/docs/faq/jobs/jobs.md",sourceDirName:"faq/jobs",slug:"/faq/jobs/",permalink:"/docs/faq/jobs/",draft:!1,tags:[],version:"current",sidebarPosition:7,frontMatter:{sidebar_position:7,sidebar_label:"Job Scheduling",hide_table_of_contents:!0,hide_title:!0,pagination_next:null,pagination_prev:null,title:"Job Scheduling"},sidebar:"FAQ"},l={},u=[{value:"Job Scheduling",id:"job-scheduling",level:2},{value:"What is Slurm?",id:"what-is-slurm",level:3},{value:"What are the frequently used commands for Slurm?",id:"what-are-the-frequently-used-commands-for-slurm",level:3},{value:"How to view the status of partitions?",id:"how-to-view-the-status-of-partitions",level:3},{value:"How to view my submitted jobs?",id:"how-to-view-my-submitted-jobs",level:3},{value:"How to cancel my job?",id:"how-to-cancel-my-job",level:3},{value:"How to control my job?",id:"how-to-control-my-job",level:3},{value:"Can I run my code for a few minutes on the login node?",id:"can-i-run-my-code-for-a-few-minutes-on-the-login-node",level:3},{value:"How can I monitor the output of my jobs that are running?",id:"how-can-i-monitor-the-output-of-my-jobs-that-are-running",level:3},{value:"Can I run interactive jobs?",id:"can-i-run-interactive-jobs",level:3},{value:"I have job scripts written for another job scheduler. Can I use them for Slurm?",id:"i-have-job-scripts-written-for-another-job-scheduler-can-i-use-them-for-slurm",level:3},{value:"When is my job going to start to run?",id:"when-is-my-job-going-to-start-to-run",level:3},{value:"Why is my job not running?",id:"why-is-my-job-not-running",level:3},{value:"How Do I Optimize My Jobs for Faster Execution?",id:"how-do-i-optimize-my-jobs-for-faster-execution",level:3},{value:"How Can I Estimate the Resources (CPU, Memory) Needed for My Job?",id:"how-can-i-estimate-the-resources-cpu-memory-needed-for-my-job",level:3},{value:"Can I Resume a Job After It Fails?",id:"can-i-resume-a-job-after-it-fails",level:3},{value:"How do I implement checkpointing in my application?",id:"how-do-i-implement-checkpointing-in-my-application",level:3},{value:"How Do I Allocate Resources for Hybrid MPI/OpenMP Jobs in Slurm?",id:"how-do-i-allocate-resources-for-hybrid-mpiopenmp-jobs-in-slurm",level:3},{value:"What Should I Do If a Compute Node Appears to Be Malfunctioning?",id:"what-should-i-do-if-a-compute-node-appears-to-be-malfunctioning",level:3},{value:"What Are Strategies for Handling Jobs with Unpredictable Runtime Behavior?",id:"what-are-strategies-for-handling-jobs-with-unpredictable-runtime-behavior",level:3}],p={toc:u},m="wrapper";function c(e){let{components:t,...n}=e;return(0,a.kt)(m,(0,o.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h2",{id:"job-scheduling"},"Job Scheduling"),(0,a.kt)("h3",{id:"what-is-slurm"},"What is Slurm?"),(0,a.kt)("p",null,"Slurm is an open source, fault-tolerant, and highly scalable cluster management and job scheduling system for clusters. It facilitates the execution of parallel jobs on the cluster in an efficient manner. For more information on Slurm, users are requested to visit ",(0,a.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/documentation.html"},"Slurm Workload Manager - Documentation"),"."),(0,a.kt)("h3",{id:"what-are-the-frequently-used-commands-for-slurm"},"What are the frequently used commands for Slurm?"),(0,a.kt)("p",null,"Here is the list of frequently used commands. For more information, users are requested to refer ",(0,a.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/documentation.html"},"Slurm Workload Manager -\nDocumentation"),"."),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"salloc")," - To allocate resources to a Slurm job with a possible\nset of constraints.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"sbatch")," - Submits a Slurm job script.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"scancel")," - Cancels a Slurm job.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"scontrol")," - To query information and manage jobs.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"sinfo")," - To retrieve information about partitions and nodes.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"squeue")," - To query the list of pending and running jobs.")),(0,a.kt)("li",{parentName:"ul"},(0,a.kt)("p",{parentName:"li"},(0,a.kt)("strong",{parentName:"p"},"srun")," - To run a parallel job on the cluster managed by Slurm."))),(0,a.kt)("h3",{id:"how-to-view-the-status-of-partitions"},"How to view the status of partitions?"),(0,a.kt)("p",null,"Users can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"sinfo")," command to view the status of partitions and nodes."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ sinfo\n")),(0,a.kt)("p",null,"Alternatively, users can run ",(0,a.kt)("inlineCode",{parentName:"p"},"scontrol show partition")," to know about partitions and their limits."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scontrol show partition\n")),(0,a.kt)("h3",{id:"how-to-view-my-submitted-jobs"},"How to view my submitted jobs?"),(0,a.kt)("p",null,"To view all the current jobs of a user, please type the following command."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ squeue -u <username>\n")),(0,a.kt)("p",null,"To view all the running jobs of a user, please type"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ squeue -u <username> -t RUNNING\n")),(0,a.kt)("h3",{id:"how-to-cancel-my-job"},"How to cancel my job?"),(0,a.kt)("p",null,"To cancel a particular job by its ",(0,a.kt)("inlineCode",{parentName:"p"},"jobid"),", use the following command."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scancel <jobid>\n")),(0,a.kt)("p",null,"To cancel a job by its name, please type"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scancel --name <jobname>\n")),(0,a.kt)("p",null,"To cancel all the jobs of a user"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scancel -u <username>\n")),(0,a.kt)("p",null,"To cancel all the ",(0,a.kt)("inlineCode",{parentName:"p"},"PENDING")," jobs of a user"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scancel -t PENDING -u <username>\n")),(0,a.kt)("h3",{id:"how-to-control-my-job"},"How to control my job?"),(0,a.kt)("p",null,"To hold a job from being scheduled"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scontrol hold <jobid>\n")),(0,a.kt)("p",null,"To release a job to be scheduled"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scontrol release <jobid>\n")),(0,a.kt)("p",null,"To requeue (cancel or rerun) a job"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ scontrol requeue <jobid>\n")),(0,a.kt)("p",null,"For more information, users can use ",(0,a.kt)("inlineCode",{parentName:"p"},"man scontrol"),", ",(0,a.kt)("inlineCode",{parentName:"p"},"man squeue"),",\n",(0,a.kt)("inlineCode",{parentName:"p"},"man scancel"),", etc."),(0,a.kt)("h3",{id:"can-i-run-my-code-for-a-few-minutes-on-the-login-node"},"Can I run my code for a few minutes on the login node?"),(0,a.kt)("p",null,"Users are not authorized to run their codes on the login node. Codes running on login nodes will be terminated automatically. Jobs ",(0,a.kt)("strong",{parentName:"p"},"have")," to be submitted through the scheduler."),(0,a.kt)("h3",{id:"how-can-i-monitor-the-output-of-my-jobs-that-are-running"},"How can I monitor the output of my jobs that are running?"),(0,a.kt)("p",null,"Users can access the output and error logs generated by Slurm while running their codes using the ",(0,a.kt)("inlineCode",{parentName:"p"},"tail")," command. Users are strongly recommended to use the example scripts given above as a base for their job scripts. Job logs are written to the current directory, from which the Slurm job was executed by ",(0,a.kt)("inlineCode",{parentName:"p"},"sbatch"),"."),(0,a.kt)("p",null,"Please note that by default ",(0,a.kt)("inlineCode",{parentName:"p"},"sbatch")," does not write the output logs. The example provided above instructs Slurm to dump the output in the format of ",(0,a.kt)("inlineCode",{parentName:"p"},"slurm.<jobid>.out"),", where ",(0,a.kt)("inlineCode",{parentName:"p"},"<jobid>")," is the job id of the slurm job. Users can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"tail")," command with ",(0,a.kt)("inlineCode",{parentName:"p"},"-f")," flag to view the output file being written continuously by Slurm."),(0,a.kt)("p",null,"For example, if a user has a job with the job id 121, and would like to view the job output, then use the following syntax."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ tail -f slurm.121.out\n")),(0,a.kt)("p",null,"Alternatively, users can use ",(0,a.kt)("inlineCode",{parentName:"p"},"vi")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"nano")," to view the output file after the job is completed."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ vi slurm.121.out\n$ nano slurm.121.out\n")),(0,a.kt)("h3",{id:"can-i-run-interactive-jobs"},"Can I run interactive jobs?"),(0,a.kt)("p",null,"Yes, the facility provides users access to interactive job scheduling. Users can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"srun")," command to setup an interactive session on the nodes. Consider an example where a user wants to request 2 nodes with 64 cores per node."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ srun -N 2 -n 1 -c 128 -p compute --pty bash -i\n")),(0,a.kt)("p",null,"Here, ",(0,a.kt)("inlineCode",{parentName:"p"},"-N")," is the number of nodes to be used. ",(0,a.kt)("inlineCode",{parentName:"p"},"-n")," is the number of tasks (instances) to be executed. ",(0,a.kt)("inlineCode",{parentName:"p"},"-c")," is the number of cores required for the task. ",(0,a.kt)("inlineCode",{parentName:"p"},"-p")," is the partition to be used. In the present example, we chose the ",(0,a.kt)("inlineCode",{parentName:"p"},"compute")," partition. ",(0,a.kt)("inlineCode",{parentName:"p"},"--pty bash")," instructs Slurm to setup a pseudo terminal in bash. ",(0,a.kt)("inlineCode",{parentName:"p"},"-i")," tells Slurm to run this command in interactive mode."),(0,a.kt)("h3",{id:"i-have-job-scripts-written-for-another-job-scheduler-can-i-use-them-for-slurm"},"I have job scripts written for another job scheduler. Can I use them for Slurm?"),(0,a.kt)("p",null,"No, you cannot execute job scripts written for other job schedulers using Slurm. But, the developers of Slurm have provided users with a documentation containing the correspondences between the options of several job schedulers. Users can access the documentation at this link. ",(0,a.kt)("a",{parentName:"p",href:"https://slurm.schedmd.com/rosetta.pdf"},"Rosetta stone of Workload manager"),"."),(0,a.kt)("h3",{id:"when-is-my-job-going-to-start-to-run"},"When is my job going to start to run?"),(0,a.kt)("p",null,"To get an estimate of when your job is going to start, users can use the ",(0,a.kt)("inlineCode",{parentName:"p"},"squeue")," command."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ squeue --start -j <jobid>\n")),(0,a.kt)("p",null,"Please note that your job might run before the scheduled start time as jobs that have finished earlier than their requested walltime might free up the queue and resources needed for your job."),(0,a.kt)("h3",{id:"why-is-my-job-not-running"},"Why is my job not running?"),(0,a.kt)("p",null,"There are several reasons why your job is not running. Users can run the ",(0,a.kt)("inlineCode",{parentName:"p"},"squeue")," command to get the status and reason."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"$ squeue -j <jobid> -l\n")),(0,a.kt)("p",null,"The ",(0,a.kt)("inlineCode",{parentName:"p"},"NODELIST(REASON)")," section in the output of the above command will have the reason, why Slurm is unable to run the job. Here are the most common reasons.\n| Job Status             | Reason                                                                                                                                                                                                                      |\n|------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|\n| BadConstraints         | The job's constraints can not be satisfied.                                                                                                                                                                                 |\n| Cleaning               | The job is being requeued and still cleaning up from its previous execution.                                                                                                                                                |\n| Dependency             | This job is waiting for a dependent job to complete.                                                                                                                                                                        |\n| JobHeldAdmin           | The job is held by a system administrator. Please contact the system administrator for more information.                                                                                                                    |\n| JobHeldUser            | The job is held by the user.                                                                                                                                                                                                |\n| NonZeroExitCode        | The job terminated with a non-zero exit code.                                                                                                                                                                               |\n| PartitionDown          | The partition required by this job is in a DOWN state.                                                                                                                                                                      |\n| Priority               | One or more higher priority jobs exist for this partition or advanced reservation.                                                                                                                                          |\n| QOSResourceLimit       | The job's Quality of Service (QOS) has reached some resource limit.                                                                                                                                                         |\n| ReqNodeNotAvail        | Some node specifically required by the job is not currently available.                                                                                                                                                      |\n| Resources              | The job is waiting for resources to become available.                                                                                                                                                                       |\n| TimeLimit              | The job exhausted its time limit.                                                                                                                                                                                           |\n| QOSMinCpuNotSatisfied  | The job's CPU request doesn't meet the minimum limit of some Quality of Service (QOS).                                                                                                                                      |\n| QOSMaxJobsPerUserLimit | The job is unable to run because the user has submitted more jobs of a certain type than are allowed to run at a time.                                                                                                      |\n| PartitionTimeLimit     | The job's time limit exceeds the partition's current time limit.                                                                                                                                                            |\n| QOSMaxGRESPerJob       | The job's GRES request exceeds the maximum each job is allowed to use for the requested Quality of Service (QOS).                                                                                                           |\n| ReqNodeNotAvail        | Some node specifically required by the job is not currently available. If the error message also lists the ",(0,a.kt)("inlineCode",{parentName:"p"},"UnavailableNodes: ")," then it is likely that there is an upcoming reservation or maintenance window on that node. |"),(0,a.kt)("h3",{id:"how-do-i-optimize-my-jobs-for-faster-execution"},"How Do I Optimize My Jobs for Faster Execution?"),(0,a.kt)("p",null,"The following are some tips for optimizing your jobs for faster execution:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Use the ",(0,a.kt)("inlineCode",{parentName:"li"},"--ntasks-per-node")," option to specify the number of tasks to run per node. This will ensure that your job runs on a single node and will avoid the overhead of inter-node communication."),(0,a.kt)("li",{parentName:"ul"},"Minimize I/O operations. For example, if your job requires reading data from a file, read the data into memory at the beginning of the job and then perform all computations in memory. Write the results to a file at the end of the job."),(0,a.kt)("li",{parentName:"ul"},"Keep your code up to date. If you are using a compiled language such as C or Fortran, use the latest compiler version available on the cluster. If you are using a scripting language such as Python or R, use the latest version of the interpreter available on the cluster.")),(0,a.kt)("h3",{id:"how-can-i-estimate-the-resources-cpu-memory-needed-for-my-job"},"How Can I Estimate the Resources (CPU, Memory) Needed for My Job?"),(0,a.kt)("p",null,"Start with a small job using estimated resources. Monitor its usage using commands like ",(0,a.kt)("inlineCode",{parentName:"p"},"sstat <jobid>")," or ",(0,a.kt)("inlineCode",{parentName:"p"},"seff <jobid>"),". Adjust the resources based on this initial run for future submissions."),(0,a.kt)("h3",{id:"can-i-resume-a-job-after-it-fails"},"Can I Resume a Job After It Fails?"),(0,a.kt)("p",null,"If your application supports checkpointing, you can resume from the last checkpoint after a job failure. Otherwise, the job will need to restart from the beginning."),(0,a.kt)("p",null,"We strongly recommend that you use checkpointing to avoid losing work in the event of a job failure."),(0,a.kt)("h3",{id:"how-do-i-implement-checkpointing-in-my-application"},"How do I implement checkpointing in my application?"),(0,a.kt)("p",null,"Checkpointing is a feature of the application itself. Please consult the documentation for your application to learn how to implement checkpointing."),(0,a.kt)("h3",{id:"how-do-i-allocate-resources-for-hybrid-mpiopenmp-jobs-in-slurm"},"How Do I Allocate Resources for Hybrid MPI/OpenMP Jobs in Slurm?"),(0,a.kt)("p",null,"To allocate resources for hybrid MPI/OpenMP jobs, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"--ntasks-per-node")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"--cpus-per-task")," options. For example, to allocate 4 MPI tasks per node with 2 OpenMP threads per task, use the following directive in your Slurm script:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-bash"},"#SBATCH --ntasks-per-node=4\n#SBATCH --cpus-per-task=2\n")),(0,a.kt)("h3",{id:"what-should-i-do-if-a-compute-node-appears-to-be-malfunctioning"},"What Should I Do If a Compute Node Appears to Be Malfunctioning?"),(0,a.kt)("p",null,"If a compute node appears to be malfunctioning, please contact the HPC team. We will investigate the issue and take appropriate action. If possible, please provide the following information:"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"The name of the compute node"),(0,a.kt)("li",{parentName:"ul"},"The job ID of the job that was running on the compute node"),(0,a.kt)("li",{parentName:"ul"},"The job script that was used to submit the job"),(0,a.kt)("li",{parentName:"ul"},"Any relevant slurm.out or slurm.err files")),(0,a.kt)("h3",{id:"what-are-strategies-for-handling-jobs-with-unpredictable-runtime-behavior"},"What Are Strategies for Handling Jobs with Unpredictable Runtime Behavior?"),(0,a.kt)("p",null,"For jobs with variable runtimes, consider implementing checkpointing and resubmitting the job if it doesn't complete in the expected time. Use Slurm\u2019s job profiling tools (",(0,a.kt)("inlineCode",{parentName:"p"},"sstat")," and ",(0,a.kt)("inlineCode",{parentName:"p"},"seff"),") to monitor and adjust resource requests."))}c.isMDXComponent=!0}}]);